import matplotlib.pyplot as plt

# 定义数据
# read_rand_bw = [5379.0, 11043.1, 15873.8, 19573.4, 21417.9, 21670.6, 21439.0, 21154.4, 20835.5, 20319.1, 19985.8,
#                 19569.3]
# write_rand_bw = [22769.4, 19888.4, 18664.3, 16845.0, 16727.3, 16243.3, 15932.9, 15490.8, 15366.4, 15159.5, 15023.3,
#                  15017.6]
# read_seq_bw = [5388.2, 11044.4, 15872.1, 19551.8, 21486.7, 21819.9, 21387.6, 20881.9, 20957.2, 20382.1, 19915.8,
#                19481.9]
# write_seq_bw = [22639.6, 23198.9, 17888.8, 17124.1, 16591.7, 16240.1, 15840.8, 15534.1, 15362.4, 15193.3, 15133.4,
#                 15018.0]


read_rand_bw = [5379.0 / 1000, 11043.1 / 1000, 15873.8 / 1000, 19573.4 / 1000, 21417.9 / 1000, 21670.6 / 1000,
                 21439.0 / 1000, 21154.4 / 1000, 20835.5 / 1000, 20319.1 / 1000, 19985.8 / 1000, 19569.3 / 1000]
write_rand_bw = [22769.4 / 1000, 19888.4 / 1000, 18664.3 / 1000, 16845.0 / 1000, 16727.3 / 1000, 16243.3 / 1000,
                 15932.9 / 1000, 15490.8 / 1000, 15366.4 / 1000, 15159.5 / 1000, 15023.3 / 1000, 15017.6 / 1000]
read_seq_bw = [5388.2 / 1000, 11044.4 / 1000, 15872.1 / 1000, 19551.8 / 1000, 21486.7 / 1000, 21819.9 / 1000,
               21387.6 / 1000, 20881.9 / 1000, 20957.2 / 1000, 20382.1 / 1000, 19915.8 / 1000, 19481.9 / 1000]
write_seq_bw = [22639.6 / 1000, 23198.9 / 1000, 17888.8 / 1000, 17124.1 / 1000, 16591.7 / 1000, 16240.1 / 1000,
                15840.8 / 1000, 15534.1 / 1000, 15362.4 / 1000, 15193.3 / 1000, 15133.4 / 1000, 15018.0 / 1000]


read_rand_lat = [562.15, 589.11, 627.09, 669.36, 743.97, 881.38, 1040.96, 1190.19, 1329.04, 1458.12, 1531.08, 1573.47]
write_rand_lat = [657.68, 1315.41, 1489.75, 1536.22, 1546.02, 1588.80, 1596.65, 1620.08, 1638.01, 1646.37, 1659.86,
                  1664.46]
read_seq_lat = [561.40, 589.43, 626.61, 667.21, 743.14, 880.13, 1040.68, 1189.70, 1326.85, 1453.04, 1530.60, 1570.95]
write_seq_lat = [656.94, 1407.15, 1455.54, 1499.98, 1544.57, 1580.76, 1603.80, 1621.31, 1640.00, 1649.33, 1662.00,
                 1669.09]

# 创建线程数列表
threads = list(range(1, 13))

# 创建图表
fig, axes = plt.subplots(2, 2, figsize=(12, 8))

# 定义图表位置
positions = {
    'read_rand': (0, 0),
    'write_rand': (0, 1),
    'read_seq': (1, 0),
    'write_seq': (1, 1)
}

# 绘制子图
for mode, pos in positions.items():
    ax = axes[pos[0], pos[1]]
    # Bandwidth
    ax.bar(threads, globals()[f'{mode}_bw'], color='#4363d8', label='Bandwidth')
    # Latency
    ax2 = ax.twinx()
    ax2.plot(threads, globals()[f'{mode}_lat'],marker='o', markersize=5,markeredgecolor="black", markerfacecolor='white', color='r', label='Latency')

    # 设置标题和图例
    ax.set_title(f'{mode.title()} Performance')
    ax.set_xlabel('Threads')
    ax.set_ylabel('Bandwidth(GB/s)')
    ax2.set_ylabel('Latency(ns)')

    ax.legend(loc='upper left')
    ax2.legend(loc='upper right')

# 调整子图间距
plt.tight_layout()

# 显示图表
# plt.show()

plt.savefig('memory_contention.pdf', bbox_inches='tight',pad_inches=0.0)